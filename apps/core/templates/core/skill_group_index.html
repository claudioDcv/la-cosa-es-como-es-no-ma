{% extends 'base.html' %}

{% load l10n %}
{% load static %}
{% load custom_tags %}

{% block subheader %}
  <div class="subnav">
    {% include "subnav.html" %}
  </div>
{% endblock %}

{% block title %}Curso ({{ course.name }}){% endblock %}

{% block content %}
{% if has_profile %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="{% url 'home' %}"><i class="fas fa-home"></i> Home</a></li>
    <li class="breadcrumb-item active" aria-current="page">Competencias</li>
  </ol>
</nav>

<div class="row row-eq-height mb-2">
    <div class="col-md-4">
      <div class="card">
        <h5 class="card-header txt-thin text-dark">
          <i class="fas fa-bolt"></i> TOTAL DE COMPETENCIAS EVALUADAS
        </h5>
        <div class="card-body cont-center bg-light">
            <div id="total_percent" class="c100">
                <span></span>
                <div class="slice">
                    <div class="bar"></div>
                    <div class="fill"></div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div class="col-md-8">
    <div class="card">
      <h5 class="card-header txt-thin">
        <i class="fas fa-check-circle"></i> NIVEL DE LOGRO
      </h5>
      <div id="skills" class="skills-graph"></div>
      <div class="chart-container" style="overflow-x:auto">
        <!-- <canvas
          id="skill-graph"
          width="400" height="200"
        ></canvas> -->
      </div>
    </div>
  </div>
</div>

<div class="row">
<div class="col-12">
  <div class="card mb-4">
    <h5 class="card-header txt-thin">
      <i class="fas fa-bolt"></i> LISTADO DE COMPETENCIAS
    </h5>
    <div class="card-body">
      {% for skill in skill_list %}
      <div class="card mb-4" id="skill-{{ skill.object.id }}">
        <div class="card-body">
          <h6 class="card-title">
            {{ skill.object.name }}
            {% if skill.evaluated_at_least_once %}
            {% else %}
              <strong>Aun no evaluado</strong>
            {% endif %}
          </h6>
          {{ skill.object.description }}
        </div>
        <div class="card-footer px-0">
          <p class="mb-2 mx-3">INDICADORES</p>
          <div class="row mx-0">
            {% for indicator in skill.indicator_list %}
              <div class="col-md-4 col-sm-6 col-xs-12">
                <div class="card mb-2">
                  <div class="card-body">
                    {% if indicator.is_evaluated %}
                  <div class="c100 p{{ indicator.str_percent|floatformat:"0" }} xs">
                      <span>{{ indicator.str_percent }}%</span>
                      <div class="slice">
                          <div class="bar"></div>
                          <div class="fill"></div>
                      </div>
                  </div>{{ indicator.object.name }} 
                  {% else %}
                  {{ indicator.object.name }} |Â Aun no se ha evaluado
                  {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
            </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>
</div>

{% else %}
No posee permisos
{% endif %}


{% endblock %}

{% block scripts %}
<script type="text/javascript">

  var data = {{ json_skill_list|safe }};
  
  var totalPercentValue = Math.floor(data.reduce(function(temp, curr) { return curr.evaluated_at_least_once ? temp + curr.percent : temp; }, 0) / data.filter(function(e) { return e.evaluated_at_least_once; }).length);
  var totalPercent = document.getElementById('total_percent');
  totalPercent.className = totalPercent.className + ' p' + totalPercentValue;
  totalPercent.children[0].innerText = totalPercentValue + '%';

  startSkills(data);

</script>
{% endblock %}
